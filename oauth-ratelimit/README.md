# oauth-ratelimit
Sample to implement a rate limit for OAuth on the API Gateway

This sample has 2 main components
 - A gateway extension to configure a rate limit at the gateway scope
 - A customized preflow for the API Gateway to use th rate limit configured above

This sample works by adding a check (a `switch` polcy) to the preflow to determine if the current call to the API Gateway is to satisfy an API request or for an OAuth service. If the call is for an OAth service then the API Properties will be configured with property `__autogenerated_oauth_api__` set to `true`. If the request is for a normal API call then the preflow is routed to a ratelimit policy with `source` set to `plan-default`. If the request is an OAuth call then the `source` is set to `catalog-named` and the oauth-rate-limit configured by the extension is used.

For more informaton about customizing the preflow for an API Gateway, please read here<br/>
https://www.ibm.com/docs/nl/api-connect/10.0.1.x?topic=policies-customizing-preflow

For more information about gateway estensions read here:<br/>
https://www.ibm.com/docs/en/api-connect/10.0.1.x?topic=behavior-configuring-your-gateway-server-extensions <br/>
https://www.ibm.com/docs/en/api-connect/10.0.1.x?topic=behavior-gateway-extension-guidelines-datapower-api-gateway

If you use have a gateway extension with a manifest, read here:<br/>
https://www.ibm.com/docs/en/api-connect/10.0.1.x?topic=gateway-extensions-manifest


## Prequisites

    IBM Datapower 10.0.1.6 - The `__autogenerated_oauth_api__` propperty is set by DataPower starting in firmware version 10.0.1.6 - this value is not set in the CD deliverables or prior firmware versions.   

```
