global-policy: 1.0.0

info:
  name: preflow-policy
  title: Preflow Policy
  version: 2.0.0
  full-custom: true

gateways:
  - datapower-api-gateway

assembly:
  execute:
    - cors:
        version: 2.0.0
        title: cors-in-preflow
    - client-identification:
        version: 2.0.0
        title: client-security-in-preflow
    - switch:
        version: 2.0.0
        title: switch
        case:
          - condition: >-
              $not($string(api.properties.__autogenerated_oauth_api__) = 'true')
            execute:
              - ratelimit:
                  version: 2.2.0
                  title: ratelimit
                  source: plan-default
          - otherwise:
              - ratelimit:
                  version: 2.2.0
                  title: ratelimit
                  source: catalog-named
                  rate-limit:
                    - name: oauth-rate-limit
                      operation: consume
    - security:
        version: 2.0.0
        title: security-in-preflow
    - invoke:
        target-url: http://myhost.com/mytarget
        version: 2.0.0
